syntax = "proto3";

package brain.state.v1;

import "brain/shared/v1/envelope.proto";
import "google/protobuf/timestamp.proto";

service ObjectAuthorityService {
  rpc PutObject(PutObjectRequest) returns (PutObjectResponse);
  rpc GetObject(GetObjectRequest) returns (GetObjectResponse);
  rpc StatObject(StatObjectRequest) returns (StatObjectResponse);
  rpc DeleteObject(DeleteObjectRequest) returns (DeleteObjectResponse);
}

message ObjectRef {
  string object_key = 1;
}

message ObjectMetadata {
  string digest_algorithm              = 1;
  string digest_version                = 2;
  string digest_hex                    = 3;
  string extension                     = 4;
  string content_type                  = 5;
  uint64 size_bytes                    = 6;
  string original_filename             = 7;
  string source_uri                    = 8;
  google.protobuf.Timestamp created_at = 9;
  google.protobuf.Timestamp updated_at = 10;
}

message ObjectRecord {
  ObjectRef ref           = 1;
  ObjectMetadata metadata = 2;
}

message PutObjectPayload {
  bytes content            = 1;
  string extension         = 2;
  string content_type      = 3;
  string original_filename = 4;
  string source_uri        = 5;
}

message PutObjectRequest {
  brain.shared.v1.EnvelopeMeta metadata = 1;
  PutObjectPayload payload              = 2;
}

message PutObjectResponse {
  brain.shared.v1.EnvelopeMeta metadata    = 1;
  ObjectRecord payload                     = 2;
  repeated brain.shared.v1.ErrorDetail errors = 3;
}

message GetObjectPayload {
  string object_key = 1;
}

message GetObjectResult {
  ObjectRecord object = 1;
  bytes content       = 2;
}

message GetObjectRequest {
  brain.shared.v1.EnvelopeMeta metadata = 1;
  GetObjectPayload payload              = 2;
}

message GetObjectResponse {
  brain.shared.v1.EnvelopeMeta metadata    = 1;
  GetObjectResult payload                  = 2;
  repeated brain.shared.v1.ErrorDetail errors = 3;
}

message StatObjectPayload {
  string object_key = 1;
}

message StatObjectRequest {
  brain.shared.v1.EnvelopeMeta metadata = 1;
  StatObjectPayload payload             = 2;
}

message StatObjectResponse {
  brain.shared.v1.EnvelopeMeta metadata    = 1;
  ObjectRecord payload                     = 2;
  repeated brain.shared.v1.ErrorDetail errors = 3;
}

message DeleteObjectPayload {
  string object_key = 1;
}

message DeleteObjectRequest {
  brain.shared.v1.EnvelopeMeta metadata = 1;
  DeleteObjectPayload payload           = 2;
}

message DeleteObjectResponse {
  brain.shared.v1.EnvelopeMeta metadata    = 1;
  bool payload                             = 2;
  repeated brain.shared.v1.ErrorDetail errors = 3;
}
